#!/bin/sh -ex

build_repo() {
  local repository=$1
  mkdir -p build/repo
  repo-add --new --remove \
    "build/repo/${repository}.db.tar.xz" \
    build/packages/*
}

main() {
  while read -r dependency; do
    sudo sh -c "pacman --noconfirm -S ${dependency}"
  done < dependencies.txt

  while read -r package; do
    ./build-package "${package}"
  done < packages.txt

  build_repo "$1"
}

main "$@"
